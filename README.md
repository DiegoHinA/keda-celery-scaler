# KEDA Celery Scaler

Only supports Redis for now.

Uses Redis queue length + Celery pub/sub heartbeats to determine actual load on Celery workers.

## Env variables

| Name                        | Description                                                                                                                                                                                                                                                      | Default                      |
|-----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|
| KCS_LOG_LEVEL               | The log level to print (panic, fatal, error, warn(ing), info, debug, trace)                                                                                                                                                                                      | info                         |
| KCS_WORKER_STALE_TIME       | When we should mark a worker as lost in seconds.                                                                                                                                                                                                                 | 10                           |
| KCS_WORKER_CLEANUP_INTERVAL | How often to clean up lost workers in seconds.                                                                                                                                                                                                                   | 5                            |
| KCS_WORKER_QUEUE_MAP        | When your Celery apps don't send the queue in the heartbeat, you can use this to map the workers by hostname. The format is {identifier}:{queue1},{queue2};{identifier2}:{queue3},{queue4}. When the identifier is found in the worker hostname, it will map it. |                              |
| KCS_REDIS_TYPE              | What type of redis to use, standalone or sentinel.                                                                                                                                                                                                               | standalone                   |
| KCS_REDIS_SERVER            | host:port list, seperated by a comma (standalone uses only the first in case of multiple given)                                                                                                                                                                  | localhost:6379               |
| KCS_REDIS_DB                | The DB to use for the connection.                                                                                                                                                                                                                                | 0                            |
| KCS_REDIS_USERNAME          | The username to use for the connection.                                                                                                                                                                                                                          |                              |
| KCS_REDIS_PASSWORD          | The password to use for the connection.                                                                                                                                                                                                                          |                              |
| KCS_REDIS_TIMEOUTS_DIAL     | The dial timeout in seconds to use for the connection.                                                                                                                                                                                                           | 5                            |
| KCS_REDIS_TIMEOUTS_READ     | The read timeout in seconds to use for the connection.                                                                                                                                                                                                           | 3                            |
| KCS_REDIS_TIMEOUTS_WRITE    | The write timeout in seconds to use for the connection.                                                                                                                                                                                                          | 3                            |
| KCS_REDIS_CONNECTIONS_MIN   | The minimum amount of connections to keep around in the pool.                                                                                                                                                                                                    | 0                            |
| KCS_REDIS_CONNECTIONS_MAX   | The maximum amount of connections to have in the pool.                                                                                                                                                                                                           | 10 * CPU COUNT               |
| KCS_REDIS_TLS_ENABLED       | Whether to use TLS in the connection.                                                                                                                                                                                                                            | False                        |
| KCS_REDIS_TLS_SERVERNAME    | The hostname to validate the certificate with.                                                                                                                                                                                                                   | Parsed from KCS_REDIS_SERVER |
| KCS_REDIS_MASTER            | The Sentinel master name in case of Sentinel.                                                                                                                                                                                                                    |                              |
| KCS_REDIS_SENTINELUSERNAME  | The username for the sentinel server.                                                                                                                                                                                                                            |                              |
| KCS_REDIS_SENTINELPASSWORD  | The password for the sentinel server.                                                                                                                                                                                                                            |                              |

